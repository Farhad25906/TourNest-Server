model User {
    id                 String     @id @default(uuid())
    email              String     @unique
    password           String
    role               UserRole   @default(TOURIST)
    needPasswordChange Boolean    @default(true)
    status             UserStatus @default(ACTIVE)
    createdAt          DateTime   @default(now())
    updatedAt          DateTime   @updatedAt

    admin            Admin?
    host             Host?
    tourist          Tourist?
    bookings         Booking[]
    payments         Payment[]
    blogComments     BlogComment[]
    blogLikes        BlogLike[]
    blogCommentLikes BlogCommentLike[]

    @@map("users")
}

model Admin {
    id            String   @id @default(uuid())
    name          String
    email         String   @unique
    profilePhoto  String?
    contactNumber String?
    isDeleted     Boolean  @default(false)
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt

    user User @relation(fields: [email], references: [email])

    @@map("admins")
}

model Host {
    id               String   @id @default(uuid())
    name             String
    email            String   @unique
    userId           String   @unique  // ADD THIS: Link to User table
    profilePhoto     String?
    phone            String?
    bio              String?
    hometown         String?
    visitedLocations String[]
    isVerified       Boolean  @default(false)
    isDeleted        Boolean  @default(false)
    tourLimit        Int      @default(4)  // Basic: 4 tours/year
    currentTourCount Int      @default(0)
    blogPostLimit    Int      @default(0)   // Basic: 0 blog posts
    currentBlogCount Int      @default(0)
    subscriptionId   String?
    createdAt        DateTime @default(now())
    updatedAt        DateTime @updatedAt
    tours            Tour[]
    blogs            Blog[]

    user          User           @relation(fields: [email], references: [email])
    subscriptions Subscription[]

    @@map("hosts")
}

model Tourist {
    id               String    @id @default(uuid())
    email            String    @unique
    name             String
    profilePhoto     String?
    bio              String?
    interests        String?
    location         String?
    visitedCountries String?
    isDeleted        Boolean   @default(false)
    createdAt        DateTime  @default(now())
    updatedAt        DateTime  @updatedAt
    bookings         Booking[]

    user User @relation(fields: [email], references: [email])

    @@map("tourists")
}

model Tour {
  id          String   @id @default(uuid())
  title       String
  description String
  destination String
  city        String
  country     String
  startDate   DateTime
  endDate     DateTime
  duration    Int     
  price       Float
  maxGroupSize Int
  currentGroupSize Int @default(0)
  category    TourCategory
  difficulty  DifficultyLevel
  included    String[] 
  excluded    String[] 
  itinerary   Json     
  meetingPoint String
  images      String[]
  isActive    Boolean  @default(true)
  isFeatured  Boolean  @default(false)
  views       Int      @default(0)
  hostId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  bookings  Booking[]
  blogs Blog[]

  host     Host     @relation(fields: [hostId], references: [id])

  @@map("tours")
}

// Enums
enum UserRole {
  ADMIN
  HOST
  TOURIST
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  INACTIVE
}

enum TourCategory {
  ADVENTURE
  CULTURE
  FOOD
  NATURE
  RELAXATION
  URBAN
  BEACH
  MOUNTAIN
}

enum DifficultyLevel {
  EASY
  MODERATE
  DIFFICULT
  EXTREME
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentMethod {
  STRIPE       // Stripe credit/debit cards
  BKASH        // Mobile payment (Bangladesh)
  NAGAD        // Mobile payment (Bangladesh)
  BANK         // Bank transfer
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  CANCELLED
  SUSPENDED
  PENDING      // Payment pending
}

enum BlogCategory {
  TRAVEL_TIPS
  DESTINATION_GUIDES
  TOUR_STORIES
  LOCAL_CULTURE
  FOOD_EXPERIENCES
  ADVENTURE_TALES
}

enum BlogStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model SubscriptionPlan {
    id            String   @id @default(uuid())
    name          String   // Basic, Standard, Premium
    description   String
    price         Float    // USD price (converted from BDT: Basic=0, Standard=$4.50, Premium=$9)
    duration      Int      @default(12) // 12 months (1 year)
    tourLimit     Int      // 4, 8, 12 tours per year
    canWriteBlogs Boolean  @default(false) // Basic: false, Standard/Premium: true
    blogPostLimit Int?     // Standard: 10, Premium: unlimited (null)
    features      String[]
    isActive      Boolean  @default(true)
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt

    subscriptions Subscription[]
    payments      Payment[]

    @@map("subscription_plans")
}

model Subscription {
    id                 String             @id @default(uuid())
    hostId             String
    planId             String
    startDate          DateTime
    endDate            DateTime
    status             SubscriptionStatus @default(PENDING)
    autoRenew          Boolean            @default(true)
    tourLimit          Int
    remainingTours     Int
    blogPostsAllowed   Boolean
    blogPostLimit      Int?
    remainingBlogPosts Int?
    createdAt          DateTime           @default(now())
    updatedAt          DateTime           @updatedAt

    host     Host             @relation(fields: [hostId], references: [id])
    plan     SubscriptionPlan @relation(fields: [planId], references: [id])
    payments Payment[]

    @@map("subscriptions")
}

model Payment {
    id              String        @id @default(uuid())
    userId          String
    bookingId       String?
    subscriptionId  String?
    amount          Float         // USD amount
    currency        String        @default("USD")
    paymentMethod   PaymentMethod
    status          PaymentStatus @default(PENDING)
    transactionId   String?
    paymentGateway  String        // stripe, bkash, nagad, bank_transfer
    gatewayResponse Json?
    paidAt          DateTime?
    createdAt       DateTime      @default(now())
    updatedAt       DateTime      @updatedAt

    user               User              @relation(fields: [userId], references: [id])
    booking            Booking?          @relation(fields: [bookingId], references: [id])
    subscription       Subscription?     @relation(fields: [subscriptionId], references: [id])
    subscriptionPlan   SubscriptionPlan? @relation(fields: [subscriptionPlanId], references: [id])
    subscriptionPlanId String?

    @@map("payments")
}

model Booking {
  id             String        @id @default(uuid())
  touristId      String
  tourId         String
  bookingDate    DateTime      @default(now())
  status         BookingStatus @default(PENDING)
  paymentStatus  PaymentStatus @default(PENDING)
  totalAmount    Float         // USD amount
  numberOfPeople Int
  specialRequests String?
  isReviewed     Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  tourist   Tourist   @relation(fields: [touristId], references: [id])
  tour      Tour      @relation(fields: [tourId], references: [id])
  payments  Payment[]

  @@unique([touristId, tourId, bookingDate])
  @@map("bookings")
}

// Blog Models (if needed)
model Blog {
  id          String      @id @default(uuid())
  title       String
  content     String
  excerpt     String?
  coverImage  String?
  category    BlogCategory
  status      BlogStatus  @default(DRAFT)
  views       Int         @default(0)
  likesCount  Int         @default(0)
  hostId      String
  tourId      String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  host        Host          @relation(fields: [hostId], references: [id])
  tour        Tour?         @relation(fields: [tourId], references: [id])
  comments    BlogComment[]
  likes       BlogLike[]

  @@map("blogs")
}